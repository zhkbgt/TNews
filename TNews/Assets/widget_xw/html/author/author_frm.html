<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
  <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
  <link rel="stylesheet" type="text/css" href="../../css/aui/aui.css" />
  <link rel="stylesheet" href="../../css/custom/common.css">
  <link rel="stylesheet" href="../../css/custom/page/author.css">
  <script src="../../script/vue/vue.js"></script>
</head>

<body>
  <div id="app" class="author" v-cloak>
    <!-- 作者信息 -->
    <section class="author-info">
      <div class="cell">
        <div class="cell__title">
          <div class="author-info__avatar">
            <v-img :url="info.avatar" err="../../image/avatar.png"></v-img>
            <!-- <img :src="info.avatar ? info.avatar : '../../image/avatar.png'"> -->
          </div>
          <div>
            <div class="author-info__nickname dark">{{ info.user_name }}</div>
            <div class="author-info__level">
              <img src="../../icon/ico_v.png">
              <span>{{ info.title }}</span>
            </div>
          </div>
        </div>
        <div class="cell__value" @click="fnFollow">
          <div v-if="!info.is_follow" class="aui-btn aui-btn-danger aui-btn-outlined">+ 关注</div>
          <div v-else class="aui-btn aui-btn-danger">取消关注</div>
        </div>
      </div>
      <div>关注：{{ info.follow }} | 粉丝：{{ info.fans_count }}</div>
      <div>{{ info.self_introduce }}</div>
    </section>
    <!-- END -->
    <!-- 作者描述 -->
    <section class="author-desc">
      <div class="wrap">
        <div class="author-desc__cell">
          <div class="author-desc__title">
            <div><img src="../../icon/ico_userid.png"></div>
          </div>
          <div class="author-desc__value hairline">{{ info.organization }}</div>
        </div>
        <div class="author-desc__cell">
          <div class="author-desc__title">
            <div><img src="../../icon/ico_document.png"></div>
          </div>
          <div class="author-desc__value hairline">{{ info.simple }}</div>
        </div>
        <div class="author-desc__cell">
          <div class="author-desc__title">
            <div><img src="../../icon/ico_bookmarks.png"></div>
          </div>
          <div class="author-desc__value">{{ info.work_record_title }}</div>
        </div>
      </div>
    </section>
    <!-- END -->
    <!-- 作者文稿集 -->
    <section class="author-article">
      <div class="author-article__head dark">文稿集</div>
      <div class="list">
        <div v-for="(el, i) in info.draft_list" :key="i" class="author-article__panel hairline" @click="toNewsDetail(el.id)">
          <div class="author-article__thumb">
            <!-- <img :src="el.cover"> -->
            <v-img :url="el.cover" err="../../image/default.png" :height="videoHeight"></v-img>
          </div>
          <div class="author-article__title dark">{{ el.title }}</div>
          <div class="author-article__desc gray">{{ el.simple }}</div>
          <div class="flex-between light">
            <div class="author-article__time">{{ el.timestamp | interval-time }}</div>
            <div class="author-article__param">
              <div v-if="el.comments"><img src="../../icon/ico_message.png">{{ el.comments }}</div>
              <div v-if="el.star"><img src="../../icon/ico_like.png">{{ el.star }}</div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- END -->
  </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script src="../../script/vue/components.js"></script>
<script src="../../script/vue/filter.js"></script>
<script src="../../script/ajax.js"></script>
<script type="text/javascript">
  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }
    return target;
  };

  var data = {
    info: {},
		videoHeight: 120, // 视频列表，封面图默认高度
    // list: []
  };

  var vm = new Vue({
    el: '#app',
    data: data,
    methods: {
      fetchProps: function fetchProps() {
        this.info = _extends({}, api.pageParam.info);
        // console.log(JSON.stringify(this.info))
      },
      init: function init() {
        this.fetchProps();
      },
      fnFollow: function fnFollow() {
        this.info.is_follow ? this.onCancelFollow() : this.onFollow();
      },
      onFollow: function onFollow() {
        var _this2 = this;

        $ajax_post('appauthor/follow_news_author', {
          user_id: 100000,
          author_id: this.info.id
        }, function (res) {
          _this2.info.is_follow = 1;

          api.toast({
            msg: res,
            duration: 1500,
            location: 'bottom'
          });
        }, {
          hideLoading: true
        });
      },
      onCancelFollow: function onCancelFollow() {
        var _this3 = this;

        $ajax_post('appauthor/cancle_follow_news_author', {
          user_id: 100000,
          author_id: this.info.id
        }, function (res) {
          _this3.info.is_follow = 0;

          api.toast({
            msg: res,
            duration: 1500,
            location: 'bottom'
          });
        }, {
          hideLoading: true
        });
      },

      toNewsDetail: function toNewsDetail(id) {
        console.log(id);
        api.openWin({
          name: 'news_detail_win',
          url: '../news_detail/news_detail_win.html',
          bounces: false,
          reload: true,
          pageParam: {
            id: id
          }
        });
      }
    },
    mounted() {
			this.videoHeight = document.body.clientWidth * 0.57;
		},
  });
  apiready = function apiready() {
    vm.init();
  };
</script>

</html>